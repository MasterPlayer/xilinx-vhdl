# axis_collector

Компонент для сбора, хранения (накопления) и передачи данных с нескольких каналов. Поток представляет собой данные, которые поступают с различных каналов в случайные моменты времени. Компонент коллекционирует эти данные в зависимости от идентификатора канала в сегменты, производит упорядочивание данных, и передает только полностью готовые пакеты.

Готовый сегмент вычисляется исходя из формулы:

$SEGMENT_BYTE_SIZE/SEGMENT_MAX_PKTS$

Компонент является параметризуемым по различным параметрам, таким как разрядность входа/выхода, работа в синхронном/асинхронном режиме, количество сегментов и размеры этих сегментов, количество пакетов сколько может храниться в сегменте. 

Компонент поддерживает ассиметричную разрядность, когда вход имеет одну разрядность, а выход - другую. 

## Структура

## generic-параметры

Компонент содержит несколько параметров чтобы можно было обеспечить гибкую конфигурацию

### список generic

№ | Параметр | тип | ограничения | описание
--|----------|-----|-------------|---------
1 | N_CHANNELS | integer | > 1 |количество каналов на которые сегментируется память
2 | N_CHANNELS_W | integer | >log2(N_CHANNELS) | разрядность шины TID
3 | SEGMENT_BYTE_SIZE | integer | >0( см.**1**) | размер каждого сегмента, который хранит данные
4 | N_BYTES_IN | integer | >0 | Входная разрядность шины данных в байтах
5 | N_BYTES_OUT | integer | >0 | Выходная разрядность шины данных в байтах
6 | ASYNC_MODE | boolean | true или false |Асинхронный режим. Позволяет производить работу в разных тактовых доменах
7 | SEGMENT_MAX_PKTS | integer | >0 |Количество пакетов внутри одного сегмента
8 | ADDR_USE | string | "full" или "high" |параметр формирования адресации
9 | TUSER_WIDTH | integer | >=1(см.**2**) | разрядность шины TUSER

**1** в зависимости от параметра ADDR_USE используются следующие условия:
- При `ADDR_USE = high` параметр должен удовлетворять условиям:

SEGMENT_BYTE_SIZE >= N_BYTES_IN 
SEGMENT_BYTE_SIZE >= N_BYTES_OUT

В противном случае генерация невозможна

- При `ADDR_USE = full` параметр должен удовлетворять условиям:

SEGMENT_BYTE_SIZE >= N_BYTES_IN + ширина TUSER
SEGMENT_BYTE_SIZE >= N_BYTES_IN + ширина TUSER

Таким образом, при 

`N_BYTES_IN = 1` 

`N_BYTES_OUT = 1`

`TUSER = 1`

SEGMENT_BYTE_SIZE не может быть меньше 2

**2** Если используется `ADDR_USE = high`, то размер TUSER не влияет на работу, так как он не учитывается. 


## Порты

### AXI-Stream 

**Внимание**
> Компонент имеет возможность работать по разным тактовым доменам между S_AXIS и M_AXIS шинами, в том числа и для внутренней логики. В случае, если `ASYNC_MODE = false`, порты S_AXIS_CLK и M_AXIS_CLK подключаются к одному и тому же тактовому сигналу, а сигналы S_AXIS_RESET и M_AXIS_RESET - к одному и тому же сигналу сброса. 

#### Slave AXI-Stream 
Название | направление |Разрядность | Назначение
---------|-------------|------------|-----------
S_AXIS_CLK | вход | 1 | сигнал тактирования S_AXIS-инфраструктуры
S_AXIS_RESET | вход | 1 | сигнал сброса логики S_AXIS-инфраструктуры
S_AXIS_TDATA | вход | N_BYTES_IN*8 | сигнал входных данных
S_AXIS_TID | вход |N_CHANNELS | сигнал номера канала для идентификации сегмента куда складывать пакет
S_AXIS_TUSER | вход | TUSER_WIDTH | сигнал для упорядочивания данных внутри одного сегмента. Участвует в адресации в качестве младшего разряда. При ADDR_USE = high не используется. 
S_AXIS_TVALID| вход | 1 | сигнал валидности данных на шине


#### Master AXI-Stream
Название | направление | Разрядность | Назначение
---------|-------------|-------------|-----------
S_AXIS_CLK | вход | 1 | сигнал тактирования M_AXIS-инфраструктуры
S_AXIS_RESET | вход | 1 | сигнал сброса логики M_AXIS-инфраструктуры
M_AXIS_TDATA | выход | N_BYTES_OUT*8 | сигнал выходных данных
M_AXIS_TID | выход | N_CHANNELS | сигнал номер канала для идентификации. Необходим для того, чтобы имелась возможность коммутации
M_AXIS_TVALID | выход | 1 | сигнал валидности данных 
M_AXIS_TREADY | вход | 1 | сигнал готовности приемника

