# axis_checker

Блок проверки значений счетчика. Работает как слейв AXI-Stream c с возможностью конфигурации ширины шины данных

## Структура
![logo](https://github.com/MasterPlayer/xilinx-vhdl/blob/master/axis_infrastructure/axis_checker/documentation/axis_checker.png)

## generic-параметры:
1) `N_BYTES` - позволяет установить размер шины данных, кратной 1 байту. 
2) `TIMER_LIMIT` - предел счета счетчика тактов для того чтобы корректно отобразить значение скорости 
3) `MODE` - выбор паттерна проверяемых данных. Возможна работа в одном из трех режимов:
- `SINGLE` - проверка организуется для данных, которые представлены обычным счетчиком, разрядность которого равна ширине данных
- `ZEROS` - проверка организуется для данных, которые представлены нулями
- `BYTE` - проверка организуется для данных, которые представлены массивом восьмибитных счетчиков. Количество счетчиков при этом равно значению N_BYTES 

## Порты 

### AXI-STREAM

Входная шина поддерживает следующие сигналы AXI-Stream:

1) `S_AXIS_TDATA` - сигнал данных. Размер задается в зависимости от N_BYTES
2) `S_AXIS_TKEEP` - сигнал валидности байт на шине данных. Проверке не подлежит и игнорируется
3) `S_AXIS_TREADY` - сигнал готовности блока к приему данных
4) `S_AXIS_TLAST` - сигнал конца пакета
5) `S_AXIS_TVALID` - сигнал валидности данных на шине. 

### Входы
Входы для конфигурации:
1) `ENABLE` - включить/выключить генератор. 
2) `PACKET_SIZE` - количество слов в пакете (1 слово = N_BYTES байт). Допустимый диапазон значений [00000001h..ffffffffh]. Комбинация 0x00000000 является разрешенной, в таком случае генератор не будет учитывать сбои в размере пакетов и любые нарушения в целостности пакетов будут игнорироваться
3) `READY_LIMIT` - Количество тактов. Определяет сколько слов будет принято за текущий период. при READY_LIMIT = 0 блок всегда готов к приему данных.
4) `NOT_READY_LIMIT` - Количество тактов сколько блок будет находится в состоянии "не готов". Если NOT_READY_LIMIT = 0, то блок всегда готов к приему данных. 


### Выходы
1) `DATA_ERROR` - счетчик ошибок по данным за текущую сессию. Обнулится, если выключить и включить через сигнал `ENABLE` или по сбросу
2) `PACKET_ERROR` - счетчик ошибок по размеру пакета за текущую сессию. Обнулится если выключить или включить компонент через сигнал `ENABLE` или по сбросу
3) `DATA_SPEED` - скорость входного потока в байт/с. Показывает с какой скоростью данные поступают на вход `S_AXIS_*`
4) `PACKET_SPEED` - скорость потока в пакетах/с. Показывает с какой скоростью пакеты поступают на вход `S_AXIS_*`
5) `HAS_DATA_ERR` - флаг возникновения ошибок в данных. Взводится каждый раз когда обнаруживается сбой в пакете. При `ENABLE`=0 неактивен
6) `HAS_PACKET_ERR` - флаг возникновения ошибок в размере пакета. Взводится каждый раз когда происходит сбой в размере пакета. При `ENABLE` = 0 неактивен.


## Принцип работы компонента
- Данный компонент является слейвом и может конфигурировать скорости входного потока путем управлением сигналом `TREADY`
- При возникновении ошибки компонент сам подстраивает внутренний счетчик под текущее значение на шине. 
- под сессией надо понимать период, когда `ENABLE = '1'`. То есть если опустить ENABLE в ноль, потом опять поднять, то сбрасываются счетчики ошибок, и сессия считается заново начатой. 
- Если блок проверки включается в работу уже в момент, когда данные идут, то он запоминает первое значение с потока, чтобы взять старт. 
- Компонент умеет работать с тремя паттернами данных. 
- `PACKET_SIZE` необязательно держать равным `READY_LIMIT`. `PACKET_SIZE` влияет только на проверку по размеру пакета, в то время как `READY_LIMIT` влияет непосредственно на логику работы компонента и других компонентов, которые подключаются к сигналу `TREADY`.

Скоростью потока можно управлять через группы сигналов READY_LIMIT и NOT_READY_LIMIT по формуле

**SPEED = (READY_LIMIT/(READY_LIMIT + NOT_READY_LIMIT)) * (N_BYTES * TIMER_LIMIT)**

где `READY_LIMIT` - размер сколько счетчик готов принять данных
`NOT_READY_LIMIT` - размер паузы сколько тактов прием невозможен
`N_BYTES` - размер байт на шине
`TIMER_LIMIT` - предел счета счетчика, при условии что этот предел - количество герц тактового сигнала за одну секунду

## Лог изменений:

**1. 21.06.2020 v1.0 - первая версия компонента**
- Позволяет принимать три разных паттерна данных
- Поддержка AXI-Stream
- Позволяет настраивать скорости потока. 
